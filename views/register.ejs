<!DOCTYPE html>
<html>
<head>
    <title>Beat | Dancing Competition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.27.2/css/uikit.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.27.2/css/components/slideshow.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.27.2/css/components/slidenav.min.css">



    <!-- <link rel="stylesheet" type="text/css" href="/css/uikit.min.css">
    <link rel="stylesheet" type="text/css" href="/css/slideshow.css">
    <link rel="stylesheet" type="text/css" href="/css/slidenav.css"> -->


    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/muikit.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://unpkg.com/cloudinary-video-player/dist/cld-video-player.min.css" rel="stylesheet">


</head>
<body>
  <div id="aviso" style="display:none;"> asfsg srg sr gsr g rg r g sr g</div>
  <div id="terminos" style="display:none;"> gds g sd g dsg  sg s g sg s g gs </div>
    <div class="main">
        <div class="container">
            <div class="registration-container ">
                <h1 class="registration-heading">¡DANCE CHALLENGE!</h1>
                <ul class="main-points">
                    <li>
                        <div>
                            <h1>1</h1>
                            <p>Junta a tus amigos (máximo 5 personas).</p>
                        </div>
                    </li><li>
                        <div>
                            <h1>2</h1>
                            <p>Grábense bailando a su estilo alguna de las siguientes 3 pistas.</p>
                        </div>
                    </li><li>
                        <div>
                            <h1>3</h1>
                            <p>Completen el formulario, suban el video, acepten los <a href="#terminos" rel="modal:open">Términos y condiciones</a> y el <a href="#aviso" rel="modal:open">Aviso de privacidad</a></p>
                        </div>
                    </li><li>
                        <div>
                            <h1>4</h1>
                            <p>Recibe tu confirmación de  participación y prepárate para  conseguir la mayor cantidad de votos.</p>
                        </div>
                    </li><li>
                        <div>
                            <h1>5</h1>
                            <p>Los videos más votados podrán ganar pases para el festival Primavera Club en Barcelona y Mutek en Ciudad de México.</p>
                        </div>
                    </li>
                </ul>
                <div class="tabs-container">
                    <ul class="uk-tab uk-tab-grid"  data-uk-tab="{connect:'#my-id'}">
                        <li class="uk-active uk-width-1-2"><a href="">REGISTRA A TU EQUIPO</a></li>
                        <li class="uk-width-1-2"><a href="">INGRESA A TU PERFIL</a></li>
                    </ul>
                </div>


                <ul id="my-id" class="uk-switcher uk-margin">
                    <li class="main-registring-container">
                        <form id="registerTeam" method="post" action="/team/register" enctype="multipart/form-data">
                            <div class="sliding-containers">
                                <div class="child-container active">
                                        <p class="label">Nombre del equipo</p>
                                        <p><small>El nombre de tu equipo debe ser sin espacios</small></p>
                                        <input type="text" class="uk-input required team-name validthis" name="teamName" id="teamName" required>
                                        <br />
                                        <button class="uk-button uk-button-primary continue team-name-continue" type="button" disabled>CONTINUAR</button>
                                </div>
                                <div class="child-container one ">
                                        <p class="label">Nombre completo del represente del equipo</p>
                                        <div>
                                            <input type="text" class="uk-input required validthis" name="representativeName" placeholder="Nombres(s)" required>
                                            <input type="text" class="uk-input required validthis" name="representativeLastName" placeholder="Apellidos"  required>
                                        </div>
                                        <p class="label">Nombre completo de cada uno de los integrantes de tu equipo</p>
                                        <div>
                                            <input type="text" class="uk-input validthis" name="teamMemberName" placeholder="Nombres(s)"  required>
                                            <input type="text" class="uk-input validthis" name="teamMemberLastName" placeholder="Apellidos"  required>
                                        </div>
                                        <div>
                                            <input type="text" class="uk-input " name="teamMemberName" placeholder="Nombres(s)"  >
                                            <input type="text" class="uk-input " name="teamMemberLastName" placeholder="Apellidos"  >
                                        </div>
                                        <div>
                                            <input type="text" class="uk-input " name="teamMemberName" placeholder="Nombres(s)"  >
                                            <input type="text" class="uk-input " name="teamMemberLastName" placeholder="Apellidos"  >
                                        </div>
                                        <div>
                                            <input type="text" class="uk-input " name="teamMemberName" placeholder="Nombres(s)"  >
                                            <input type="text" class="uk-input " name="teamMemberLastName" placeholder="Apellidos"  >
                                        </div>
                                        <br />
                                        <button class="uk-button uk-button-primary continue" type="button">CONTINUAR</button>
                                </div>
                                <div class="child-container two">
                                        <p class="label">Correo electrónico del representante</p>
                                        <input type="email" class="uk-input required validthis" name="teamRepresentativeEmail" placeholder="correo@tucorreo.com" required>
                                        <p class="label">Teléfono de contacto del representante</p>
                                        <input type="digits" class="uk-input required validthis" name="teamRepresentativeNumber" placeholder="10 digitos" required minlength="10" maxlength="10">
                                        <br />
                                        <button class="uk-button uk-button-primary continue" type="button">CONTINUAR</button>
                                </div>
                                <div class="child-container three">
                                        <p class="label">Estado</p>
                                        <div class="select-container">
                                            <select type="" class="uk-input" id="stateNames" name="state">
                                                <option value="Distrito Federal">Distrito Federal</option>
                                                <option value="Puebla">Puebla</option>
                                                <option value="Aguascalientes">Aguascalientes</option>
                                                <option value="Baja California">Baja California</option>
                                                <option value="Baja California Sur">Baja California Sur</option>
                                                <option value="Campeche">Campeche</option>
                                                <option value="Chiapas">Chiapas</option>
                                                <option value="Chihuahua">Chihuahua</option>
                                                <option value="Coahuila">Coahuila</option>
                                                <option value="Colima">Colima</option>
                                                <option value="Durango">Durango</option>
                                                <option value="Guanajuato">Guanajuato</option>
                                                <option value="Guerrero">Guerrero</option>
                                                <option value="Hidalgo">Hidalgo</option>
                                                <option value="Jalisco">Jalisco</option>
                                                <option value="Mexico">Mexico</option>
                                                <option value="Michoacan">Michoacan</option>
                                                <option value="Morelos">Morelos</option>
                                                <option value="Nayarit">Nayarit</option>
                                                <option value="Nuevo Leon">Nuevo Leon</option>
                                                <option value="Oaxaca">Oaxaca</option>
                                                <option value="Puebla">Puebla</option>
                                                <option value="Queretaro">Queretaro</option>
                                                <option value="Quintana Roo">Quintana Roo</option>
                                                <option value="San Luis Potosi">San Luis Potosi</option>
                                                <option value="Sinaloa">Sinaloa</option>
                                                <option value="Sonora">Sonora</option>
                                                <option value="State (Estado)">State (Estado)</option>
                                                <option value="State of Mexico">State of Mexico</option>
                                                <option value="Tabasco">Tabasco</option>
                                                <option value="Tamaulipas">Tamaulipas</option>
                                                <option value="Veracruz">Veracruz</option>
                                                <option value="Yucatan">Yucatan</option>
                                                <option value="Zacatecas">Zacatecas</option>
                                            </select>
                                        </div>
                                        <p class="label">Ciudad</p>
                                        <div class="select-container">
                                            <select type="" class="uk-input" name="city" id="cityNames">
                                                <option balue="Mexico City">Mexico City</option>
                                            </select>
                                        </div>
                                        <br />
                                        <button class="uk-button uk-button-primary continue" type="button">CONTINUAR</button>
                                </div>
                                <div class="child-container four">
                                        <p class="label">Carga tu video</p>
                                        <div class="loader">
                                        <img src="/images/loader.gif"/>
                                        <p><small>Tu video se está procesando</small></p>
                                        </div>
                                        <div class="video-container">
                                            <div class="main-video">
                                                <video
                                                  id="demo-player"
                                                  controls
                                                  autoplay
                                                  class="cld-video-player"
                                                  data-cld-public-id="">
                                                </video>
                                            </div>
                                            <br />
                                            <div class="video-error">

                                            </div>
                                        </div>
                                        <br />
                                        <input type="file" class="uk-input required validthis" name="video" placeholder="Busar archivo" id="video" required>
                                        <p>Tu video debe durar máximo 30 sec.</p>
                                        <p>Formatos aceptables <b>mov</b> y <b>mp4</b></p>
                                        <p>El video debe ser grabado en formato horizontal.</p>
                                        <p>Únicamente se pueden subir videos en horizontal.</p>
                                        <br />
                                        <p class="label">Estás por completar tu formulario de registro.</p>
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="privacyPermission" name="privacyPermission" value="privacyPermission" style="width:initial;" class="uk-checkbox checkbox-required validthis" required>
                                            <label for="coding">Acepto el aviso de privacidad</label>
                                            </br>
                                            <input type="checkbox" id="termsAndConditions" name="termsAndConditions" value="termsAndConditions" style="width:initial;" class="uk-checkbox checkbox-required validthis" required>
                                            <label for="coding">Acepto los términos y condiciones</label>
                                        </div>
                                        <br />
                                        <button class="uk-button uk-button-primary submitRegistrationForm" type="button" disabled>CONFIRMAR REGISTRO</button>
                                </div>

                                <div class="child-container five">
                                        <p class="label">En los próximos 20 min. <br />recibirás un correo electrónico <br />con la confirmación de tu registro.</p>
                                        <p class="label">En el correo electrónico<br /> de confirmación encontrarás<br /> las instrucciones de<br /> las siguientes etapas<br /> de tu participación.</p>
                                        <p class="label">¡ Muchas gracias por<br /> tu participación !</p>
                                </div>
                                <div class="dotnav">
                                    <ul>
                                        <li class="active dot1"></li>
                                        <li class="dot2"></li>
                                        <li class="dot3"></li>
                                        <li class="dot4"></li>
                                        <li class="dot5"></li>
                                    </ul>
                                </div>
                            </div>
                            <input type="hidden" name="video_url" id="video-url-input" value="">
                            <input type="hidden" name="duration" id="duration" value="">
                            <input type="hidden" name="public_id" id="public_id" value="">
                        </form>
                    </li>
                    <li class="main-login-container">
                        <div class="sliding-containers">
                            <div class="child-container active">
                                <form action="/team/login" method="POST">
                                     <p class="label">Nombre De Equipo</p>
                                    <input type="text" class="uk-input" name="teamName">
                                    <p class="label">Contraseña</p>
                                    <input type="password" class="uk-input" name="password">
                                    <br />
                                    <button class="uk-button uk-button-primary" type="submit">CONTINUAR</button>
                                </form>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

    </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.27.2/js/uikit.min.js"></script>
    <script type="text/javascript" src="/bower_components/jquery-validation/dist/jquery.validate.min.js"></script>
    <!-- <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/uikit.min.js"></script>
    <script type="text/javascript" src="/js/jquery.validate.js"></script> -->
    <script type="text/javascript" src="/js/main.js"></script>
    <!-- <script type="text/javascript" src="/js/slideshow.js"></script> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.27.2/js/components/slideshow.js"></script>
    <script src="https://unpkg.com/cloudinary-core/cloudinary-core-shrinkwrap.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/cloudinary-video-player/dist/cld-video-player.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function(){

            $(window).keydown(function(event){
                if(event.keyCode == 13) {
                  event.preventDefault();
                  return false;
                }
            });

            $(".submitRegistrationForm").click(function(){
                var error = false;
                $(".checkbox-required").each(function(){
                    var self = $(this);
                    var video = $("#video");
                    if(document.getElementById("video").files.length == 0){
                        error=true;
                        if(!video.next().hasClass("validation")){
                            video.after("<div class='validation' style='color:red;margin-bottom: 20px;'>Por favor selecciona un video.</div>");
                        }
                    }

                    if(self.is(":checked")){

                    }
                    else
                    {
                        if(!self.next().next().hasClass("validation")){
                            self.next().after("<div class='validation' style='color:red;margin-bottom: 20px;'>Este campo es obligatorio.</div>");
                        }
                        error=true;
                    }
                })

                if(!error){
                    $('#registerTeam').submit();
                }

            })
            var x = 1;

            var validator = $("#registerTeam").validate();
            $(".child-container .continue").click(function(e){
                var error = false;
                var self = $(this);
                self.parent().find(".validthis").each(function(){
                    if(!validator.element($(this))){
                        error = true;
                    }
                });

                if(!error){
                    x++;
                    if(x<6){
                        $(".dot"+x).addClass("active");
                    }
                    self.parent().removeClass("active");
                    self.parent().next().addClass("active");
                }

            })


            var textInput = $(".team-name");
            var timeout = null;
            textInput.on('keypress', function (event) {
                var regex = new RegExp("^[a-zA-Z0-9]+$");
                var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                if (!regex.test(key)) {
                   event.preventDefault();
                   return false;
                }
            });

            textInput.keyup(function(e){
                if(e.which == 13) {

                }
                else
                {
                    clearTimeout(timeout);
                    $(".team-name-continue").prop('disabled', true);
                    // Make a new timeout set to go off in 800ms
                    timeout = setTimeout(function () {
                        if(textInput.val().trim() != ""){
                            console.log('Input Value:', textInput.val());
                            if(textInput.next().hasClass("validation-check")){
                                            textInput.next().remove();
                            };
                            textInput.after('<i class="validation-check fa fa-spinner fa-spin" aria-hidden="true" style="width:17px"></i>');

                            $.ajax({
                                url:"/team/checkTeamName",
                                method:"POST",
                                data:{team:textInput.val()},
                                success:function(data){
                                    if(data){
                                        if(textInput.next().hasClass("validation-check")){
                                            textInput.next().remove();
                                        };

                                        textInput.after('<i class="validation-check fa fa-check green"></i>');
                                        $(".team-name-continue").prop('disabled', false);
                                        textInput.css("border-color","#399931");


                                    }
                                    else
                                    {
                                        if(textInput.next().hasClass("validation-check")){
                                            textInput.next().remove();
                                        };
                                        textInput.after('<i class="validation-check fa fa-times red"></i>');
                                        $(".team-name-continue").prop('disabled', true);
                                        textInput.css("border-color","#a83636");

                                    }
                                    console.log(data);
                                },
                                error:function(err){
                                    console.log(err)
                                }
                            })
                        }
                        else {
                            if(textInput.next().hasClass("validation-check")){
                                textInput.next().remove();
                                textInput.css("border-color","#8C8C8C");
                            };
                        }

                    }, 500);
                }

            })



            $.getJSON("states.json", function(json) {
                var states=json;
                $("#stateNames").on("change", function(){
                    var state = this.value;
                    console.log(state);
                    $("#cityNames").html("");
                    states[state].forEach(function(city){
                        console.log(city);
                        $("#cityNames").append("<option value="+city+">"+city+"</option>");
                    })
                })
            });



            var cld = cloudinary.Cloudinary.new({ cloud_name: "diaa7wkfp", secure: true});
            var demoplayer = cld.videoPlayer('demo-player');



            $("#video").change(function(){
                $(".video-container").hide();
                $(".loader").show();
                $(".video-error").html("");
                var form = this.files[0];
                var data = new FormData();
                jQuery.each(jQuery('#video')[0].files, function(i, file) {
                    data.append('video', file);
                });
                $.ajax({
                      url: '/team/upload/video',
                      type: 'POST',
                      success: function (res) {
                        var path = res.public_id;
                        demoplayer.source(path);
                        $(".loader").hide();
                        $(".video-container").show();
                        $(".submitRegistrationForm").prop("disabled",false);
                        $("#video-url-input").val(res.url);
                        $("#duration").val(res.duration);
                        $("#public_id").val(res.public_id);
                      },
                      error:function(err){
                        $(".loader").hide();
                        $(".video-error").html('<p class="red">'+err.responseJSON.error+"</p>");
                        $(".video-container").show();
                        $(".submitRegistrationForm").prop("disabled",true);
                        console.log(err);
                      },
                      cache: false,
                      data: data,
                      contentType: false,
                      processData: false
                  });
            })
        })

    </script>
</body>
</html>
